<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/style.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
        <script src="https://use.fontawesome.com/f300c85415.js"></script>
    </head>
    <body>
        <header></header>
        <nav class="drawer" data-bind="css:{'drawer--open': showDrawer()}">
            <i class="fa fa-bars" aria-hidden="true" data-bind="click: toggleShowDrawer"></i>
            <div class="drawer__filter">
                <input class="drawer__filter__searchbox" placeholder="Search for a place" data-bind="value: filterValue, valueUpdate: 'afterkeydown', event: {keypress: closeInfoWindow}"></input>
                <ul data-bind="foreach: places" id="filter-list" class="drawer__filter__list">
                    <li data-bind="text: name(), visible: visible(), click: $root.chooseListItem" 
                    class="drawer__filter__list-item"></li>
                </ul>
                <button class="drawer__filter__export-btn" data-bind="click: exportLocations">Export locations</button>
                <input type="file" name="file" id="file" class="drawer__filter__import-input" data-bind="visible: supportFileAPI, event: {change: handleJSONSelect}" />
                <label for="file" data-bind="visible: supportFileAPI" class="drawer__filter__import-btn">Import locations</label>
            </div>
        </nav>
        <div class="create-location" data-bind="css:{'create-location--open': creatingPlace()}">
            <i class="fa fa-plus" aria-hidden="true" data-bind="click: toggleCreatingPlace"></i>
            <i class="fa fa-minus" aria-hidden="true" data-bind="click: toggleCreatingPlace"></i>
            <span class="create-location__title">Add Location</span>
            <form class="create-location__form location-form" data-bind="submit: $root.addLocation,  with: $root.newPlace">
                <input class="location-form__name" placeholder="Name" data-bind="textInput: name"></input>
                <textarea class="location-form__info" placeholder="Write down some information about your session at this spot" data-bind="textInput: info"></textarea>
                <button type="submit" class="location-form__submit">Pin to center</button>
                <p>When you submit this form, a green pin will be added to the center of the map. You can then drag it to its correct location.</p>
            </form>
        </div>
        <div id="map"></div>
        </div>
        <div  class="large-info-window" id="large-info-window" data-bind="with: selectedPlace, css:{'large-info-window--open': $root.showLargeInfoWindow()}">
            <span class="large-info-window__toggle" data-bind="click: $root.toggleShowLargeInfoWindow">More Info</span>
            <span class="large-info-window__bottom-toggle" data-bind="click: $root.toggleShowLargeInfoWindow">Show Map</span>
            <div class="large-info-window__info info" id="info-wrapper">
                <label class="info__name" data-bind='text: name, visible: !editing(),event: { dblclick: setEditing }, doubleTap: setEditing'></label> 
                <input class='info__name--edit' data-bind="value: name, visible: editing,  valueUpdate: 'afterkeydown', enterKey: saveEditing, escapeKey: undoEditing"></input>
                <label class="info__latlng">lat: <span data-bind='text: latlng().lat'></span></label> 
                <label class="info__latlng">lng: <span data-bind='text: latlng().lng'></span> </label>
                <p class="info__info" data-bind='text: info, visible: !editing(),event: { dblclick: setEditing }, doubleTap: setEditing'></p> 
                <textarea class='info__info--edit' data-bind="value: info, visible: editing,  valueUpdate: 'afterkeydown', escapeKey: undoEditing"></textarea>
                <h3>Images</h3>
                <div class="info__images images">
                    <!-- ko foreach: images -->
                      <img data-bind='attr: {src: url}' class="images__image"/>
                      <p class="images__image-caption" data-bind='text: caption, 
                      visible: !($parent.editing()), event: { dblclick: $parent.setEditing.bind($parent) }, 
                      doubleTap: $parent.setEditing.bind($parent)'></p>
                      <input class='images__image-caption--edit' data-bind="value: caption, visible: $parent.editing,  valueUpdate: 'afterkeydown', enterKey: $parent.saveEditing.bind($parent), escapeKey: $parent.undoEditing.bind($parent)"></input>
                    <!-- /ko -->
                </div>
                <div data-bind="visible: !editing()">
                    <input type="file" name="imageFile" id="imageFile" class="info__image-input" 
                    accepts="image/jpeg, image/jpg, image/png, image/bmp" data-bind="visible: $root.supportFileAPI, event: {change: $root.handleImageSelect.bind($root)}" />
                    <label for="imageFile" data-bind="visible: $root.supportFileAPI" class="info__image-select-btn">Select image</label> 
                    <!--<input class='session__image-caption-input' placeholder="Add a caption to the image" data-bind="value: caption, valueUpdate: 'afterkeydown', enterKey: saveEditing, escapeKey: undoEditing"></input>-->
                    <div class="line-break"></div>
                    <img src="" id="previewImg" class="info__preview-image">
                    <div class="line-break"></div>
                    <textarea name="caption" id="image-caption" placeholder="Write some infomation about this image" class="info__image-caption hidden"></textarea>
                    <div class="line-break"></div>
                    <button id="images-upload-btn" class="info__image-upload-btn hidden" data-bind="click: $root.uploadImage.bind($root)">Submit</button>
                </div>
                <button data-bind='click: saveEditing, visible: (editing())'>
                    Update
                </button>
                <button data-bind='click: undoEditing, visible: (editing())'>
                    Cancel
                </button>
            </div>
        </div>
        <script type="text/template" id="info-window-template">
            "<h2 data-bind='text: name'></h2>"+
            "lat: " + "<span data-bind='text: latlng().lat'></span>"+
            "lng: " + "<span data-bind='text: latlng().lng'></span>"
        </script>
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="bower_components/knockout/dist/knockout.js"></script>
        <script src="js/keyhandling.js"></script>
        <script src="js/doubletap.js"></script>
        <script src="js/console-save.js"></script>
        <script src="js/imageResizer.js"></script>
        <script src="js/main.js"></script>
        <script src="js/setListHeight.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.7.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.7.3/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.7.3/firebase-storage.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.7.3/firebase-auth.js"></script>
        <script>
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyDCYpUjurtGKHJ3mIpMik5_mLhRrVgM33E",
            authDomain: "surf-sessions-7accd.firebaseapp.com",
            databaseURL: "https://surf-sessions-7accd.firebaseio.com",
            storageBucket: "surf-sessions-7accd.appspot.com",
            messagingSenderId: "246363609320"
          };
          firebase.initializeApp(config);
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDatOjMfgbYIs1bJy8oF90D-fmjZF-jIVQ&callback=module.initMap" onerror="module.initWithoutMap()" async defer></script>
    </body>
</html>
